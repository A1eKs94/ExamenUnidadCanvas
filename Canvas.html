<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Canvas</title>
    <style>
      body {
        background-color: rgb(107, 107, 107);
      }
      canvas {
        background-color: rgb(199, 199, 199);
      }
    </style>
  </head>
  <body>
    <canvas id="myCanvas" width="500" height="500"></canvas>

    <script>
      const myCanvas = document.getElementById("myCanvas");
      const ctx = myCanvas.getContext("2d");

      class Rectangulo {
        constructor(alto, ancho, x, y, color, speed) {
          this.alto = alto;
          this.ancho = ancho;
          this.x = x;
          this.y = y;
          this.color = color;
          this.speed = speed;
        }

        colision(otro) {
          return (
            this.x < otro.x + otro.ancho &&
            this.x + this.ancho > otro.x &&
            this.y < otro.y + otro.alto &&
            this.y + this.alto > otro.y
          );
        }
      }

      var pause = false;
      var player = new Rectangulo(50, 50, 100, 100, "red", 5);
      var target = new Rectangulo(10, 10, 150, 150, "black", 0);
      var blueOrb = new Rectangulo(10, 10, 200, 200, "blue", 0);
      var redOrb = new Rectangulo(10, 10, 280, 280, "red", 0);

      var walls = [];
      walls.push(new Rectangulo(100, 30, 0, 200, "blue", 0));
      walls.push(new Rectangulo(100, 30, 250, 200, "blue", 0));
      walls.push(new Rectangulo(30, 300, 100, 20, "blue", 0));
      walls.push(new Rectangulo(30, 300, 100, 450, "blue", 0));
      walls.push(new Rectangulo(100, 30, 470, 200, "red", 0));

      var points = 0;
      var move = "";

      document.addEventListener("keypress", function (e) {
        if (e.keyCode == 119) {
          move = "up";
        }
        if (e.keyCode == 115) {
          move = "down";
        }
        if (e.keyCode == 97) {
          move = "left";
        }
        if (e.keyCode == 100) {
          move = "right";
        }
        if (e.keyCode == 32) {
          pause = !pause;
        }
      });

      function moveUpdate() {
        let prevX = player.x;
        let prevY = player.y;

        if (!pause) {
          if (move == "up") {
            player.y -= player.speed;
          }
          if (move == "down") {
            player.y += player.speed;
          }
          if (move == "left") {
            player.x -= player.speed;
          }
          if (move == "right") {
            player.x += player.speed;
          }
        }

        // En caso de que sobrepase los l√≠mites
        if (player.x < 0) {
          player.x = 499;
        }
        if (player.x > 500) {
          player.x = 0;
        }
        if (player.y < 0) {
          player.y = 499;
        }
        if (player.y > 500) {
          player.y = 0;
        }

        if (player.colision(target)) {
          target.x = Math.floor(Math.random() * 490);
          target.y = Math.floor(Math.random() * 490);
          points += 1;
        }

        getOrb();

        wallColision(prevX, prevY);

        paint();
      }

      function paint() {
        ctx.clearRect(0, 0, 500, 500);

        ctx.font = "20px Arial";
        ctx.fillStyle = "black";
        ctx.fillText("Speed: " + player.speed, 400, 20);
        ctx.fillText("Points: " + points, 20, 20);

        // Jugador
        ctx.fillStyle = player.color;
        ctx.fillRect(player.x, player.y, player.ancho, player.alto);

        // Target
        ctx.fillStyle = target.color;
        ctx.fillRect(target.x, target.y, target.ancho, target.alto);

        // BlueOrb
        ctx.fillStyle = blueOrb.color;
        ctx.fillRect(blueOrb.x, blueOrb.y, blueOrb.ancho, blueOrb.alto);

        // RedOrb
        ctx.fillStyle = redOrb.color;
        ctx.fillRect(redOrb.x, redOrb.y, redOrb.ancho, redOrb.alto);

        // Pared
        walls.forEach(function (wall) {
          ctx.fillStyle = wall.color;
          ctx.fillRect(wall.x, wall.y, wall.ancho, wall.alto);
        });

        requestAnimationFrame(moveUpdate);
        if (pause) {
          ctx.font = "50px Arial";
          ctx.fillStyle = "black";
          ctx.fillText("P A U S A", 150, 200);
          ctx.fillStyle = "rgba(32, 45, 21, 0.3)";
          ctx.fillRect(0, 0, 500, 500);
        }
      }

      function wallColision(prevX, prevY) {
        walls.forEach(function (wall) {
          if (player.colision(wall) && player.color !== wall.color) {
            player.x = prevX;
            player.y = prevY;
            move = "";
          }
        });
      }

      function getOrb() {
        if (player.colision(blueOrb)) {
          player.color = blueOrb.color;
          blueOrb.x = Math.floor(Math.random() * 490);
          blueOrb.y = Math.floor(Math.random() * 490);
        }

        if (player.colision(redOrb)) {
          player.color = redOrb.color;
          redOrb.x = Math.floor(Math.random() * 490);
          redOrb.y = Math.floor(Math.random() * 490);
        }
      }

      requestAnimationFrame(paint);
    </script>
  </body>
</html>
